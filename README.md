<project_description>
 
# Autobgm (For SillyTavern)

## 설명
- 깃허브 내에서 SillyTavern 전용 확장 제작 중임

- 제작 목적: 프리셋에 추가한 BGM들에 키워드를 매칭, Ai의 마지막 메시지에 해당 키워드가 있을 시 우선도에 따라 mp3 파일을 웹으로 자동 재생하는 확장을 만들고 싶었음

### 사용 방법 및 기능

#### For chatting
0) 해당 확장을 SillyTavern의 확장 프로그램 설치를 눌러 설치
( 링크: https://github.com/GgangMyChaeng/AutoBGM )
1) 확장 메뉴 중 AutoBGM을 눌러 메뉴를 펼친 뒤 Enabled를 눌러 해당 확장을 활성화
2) Enabled 버튼 아래 톱니바퀴(Settings) 버튼 클릭을 통해 해당 확장의 모달 화면 활성화
3) 프리셋 제작 or 캐릭터 카드 전용 프리셋 (봇 카드 선택 시 자동 생성됨) or 프리셋 불러오기
4) BGM 삽입 (mp3 파일을 개별로 넣거나 Zip으로 압축한 상태의 mp3 파일들도 가능)
5) BGM list의 bgm별로 키워드 매칭 (쉼표를 사용하여 다수의 키워드 매칭 가능)
6) 개인 세팅
  * 마지막 ai 메시지에 키워드 없을 시 자동으로 재생될 Default audio 지정 (하지 않아도 무관)
  * 볼륨 조정
  * 우선도(Priority) 조정: 다수의 키워드가 지문에 걸렸을 때, 해당 값이 가장 큰 BGM을 재생
7) 키워드 모드(Keyword Mode)*가 켜져있는 상태로 모달 화면을 닫고 채팅
  * 키워드 모드(Keyword Mode): 해당 기능을 활성화할 시, Ai의 마지막 메시지에서 키워드가 인식되면 자동으로 해당 BGM이 조건에(키워드 인식, 우선도 등) 따라 자동 재생됨

#### For presets’ import · export
- Import 시 해당 프리셋의 명칭·파일명·키워드·우선도·볼륨 설정만 불러와짐. BGM을 위한 mp3 파일은 따로 또 삽입해 줘야 함.
- Export 시 바로 위에 언급된 설정들이 저장된 파일이 생성됨. BGM을 위한 mp3 파일까지 저장·공유를 하고 싶다면 개인이 따로 세팅해야 함.

#### For BGM
- mp3 파일과 (개별 삽입) zip으로 압축된 상태의 mp3 파일들까지 호환 가능
- 해당 프리셋에 저장한 mp3 파일들은 BGM list에서 삭제 가능
  * 개별로 삭제하거나, 여러 개씩 삭제할 수도 있음

## 현재 깃허브 폴더 상태
### AutoBGM 폴더(github root) 안에:
- index.js
- manifest.json
- style.css
### AutoBGM/templates 폴더 안에:
- popup.html
- window.html
### AutoBGM/vendor 폴더 안에:
- jszip.min.js

## 체크 리스트
### @SillyTavern확장 메뉴에서...@
- 해당 확장이 SillyTavern 내의 확장 메뉴에 뜨는가? (o)
- 확장 메뉴 ui가 적용됐는가? (o)
- 확장 메뉴에서 톱니바퀴 버튼(settings)을 눌렀을 때 모달이 뜨는가? (o)
- Enabled 버튼을 통해 해당 확장의 활성화·비활성화가 기능하는가? (O)
### @모달에서...@
- 모달 ui가 적용됐는가? (o)
- 화면폭이 줄어들거나 넓어짐에 따라 모달 창 크기가 최적화되는가? (O)
- 프리셋 ui가 정상적으로 세팅됐는가? (O)
- BGM list의 ui가 정상적으로 세팅됐는가? (o)
- BGM list의 각 항목의 설정 전체를 접거나 펼칠 수 있는가? (O)
- BGM 개별 항목 볼륨 설정 전체 락버튼이 기능하는가? (O)
- 프리셋이나 BGM 파일 삭제 전 쿠션(확인 메시지)이 뜨는가? (O)
### @프리셋에서...@
- 프리셋 기능인
  * 저장, 삭제가 작동하는가? (o)
  * 불러오기, 내보내기가 작동하는가? (o)
  * 불러오기 시, 유저의 기존 프리셋이 초기화되지 않고 해당 프리셋만 추가로 불러와지는가? (o)
  * 내보내기 시, 해당 프리셋 명칭 그대로 저장되는가? (O)
### @BGM list에서...@
- BGM list의 기능인
  * BGM 개별 삽입, 삭제가 작동하는가? (O)
  * mp3 파일이 담긴 zip 폴더를 삽입했을 시 BGM 파일을 인식하는가? (o)
  * 키워드 저장이 작동하는가? (O)
  * 개별 볼륨 조절 설정이 저장되는가? (O)
  * 볼륨 설정 스크롤 바와 입력창의 값이 호환되는가? (O)
  * BGM이 이름 알파벳 순, 알파벳 역순 혹은 추가한 순, 추가한 역순으로 정렬되는가? (O)
  * Default BGM이 설정되는가? (O)
  * 키워드 모드 비활성화 상태에서 사용 가능한 > 일반 재생 / 랜덤 재생 / 단일 무한 재생 / 설정한 순서별 무한 재생 버튼이 있는가? (O)
- AutoBGM의 기능인
  * BGM 재생, 일시정지가 작동하는가? (O)
  * 개별 볼륨 조절 설정이 작동하는가? (O)
  * 키워드 모드 활성화 중에 인식된 키워드가 없을 시 Default로 설정해둔 BGM이 상시 재생되는가? (X)
  * 키워드 모드 활성화 중에 Default BGM도 없고, 키워드 변동도 없을 시 이전에 재생 중이었던 BGM이 유지(자동 무한 재생)되는가? (X)
  * 키워드 모드 비활성화 상태에서 일반 재생 / 랜덤 재생 / 단일 무한 재생 / 설정한 순서별 무한 재생 기능이 정상 작동하는가? (X)
  * 키워드 모드 버튼을 통해 키워드 인식 기반 자동 재생 기능이 활성화·비활성화 되는가? (X)
  * 특정 프리셋을 특정 캐릭터(들)에게 매칭하는 설정이 작동하는가? (X)
  * BGM이 채팅마다 키워드를 인식해 각각 정상 작동하는가? (X)
  * BGM이 채팅에서 나왔을 시 정상적으로 꺼지는가? (X)
  * 키워드 모드 활성화 시, Ai의 마지막 메시지에만 반응하는가? (X)

## 원하는 방향 디테일 (초안)
- 프리셋: 저장, 삭제, 내보내기, 불러오기
- BGM: 
  * 기본: 삽입(해당 경로에 저장), 삭제, 
  * 키워드 매칭 (wi처럼 쉼표로 키워드 다수 매칭 가능하게)
  * 키워드 인식 후 자동 재생:
    - ai 메시지에만 반응해야 함
    - 키워드 변동이 없을 시 BGM이 유지되어야 함
    - 해당 채팅에서 나왔을 때는 자동으로 OFF되어야 함
    - 해당 채팅에 다시 들어갔을 때는 자동으로 ON되어야 함(확장 enabled일 때만)
    - BGM mp3 파일별 개별 볼륨 조절 설정(mp3 파일의 사운드 트랙 볼륨이 다를 수 있으므로 확장에서 세부적으로 따로 조절할 수 있도록)

</project_description>

## License
This project is licensed under CC BY-NC-ND 4.0.
Third-party libraries are licensed separately (see LICENSE’S NOTICE).

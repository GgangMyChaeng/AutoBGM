<!-- templates/popup.html -->
<div class="autobgm-modal">
  <div class="autobgm-modal-h">
    <b>AutoBGM Settings</b>
    <div class="menu_button" id="abgm_modal_close" title="Close">
      <i class="fa-solid fa-xmark fa-lg"></i>
    </div>
  </div>

<!-- 상단 옵션 -->
<div class="abgm-top-controls">

  <!-- Now Playing -->
    <div class="abgm-nowplaying" style="display:flex; gap:10px; align-items:baseline; flex-wrap:wrap; padding:8px 10px; border:1px solid rgba(255,255,255,.12); border-radius:12px; background:rgba(0,0,0,.18); margin:10px 0;">
      <small style="opacity:.75;">Now Playing</small>
      <b id="abgm_now_title" style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:100%;">(none)</b>
      <small id="abgm_now_state" style="opacity:.7;">Stopped</small>
      <small id="abgm_now_meta" style="opacity:.65;">—</small>
    </div>

  <!-- 1줄: Keyword / Debug / Play Mode -->
  <div class="abgm-top-row3">

    <!-- Keyword (좌측) -->
    <label class="checkbox_label abgm-top-item left" style="margin:0;">
      <input type="checkbox" id="abgm_keywordMode">
      <small>Keyword Mode</small>
    </label>

    <!-- Debug (중앙: 아이콘 + (PC에서만 텍스트)) -->
    <label class="checkbox_label abgm-top-item center" style="margin:0;" title="Debug Mode">
      <input type="checkbox" id="abgm_debugMode">
      <i class="fa-solid fa-bug"></i>
      <small class="abgm-debug-text">Debug</small>
    </label>

    <!-- Play Mode (우측) -->
    <div class="abgm-top-item right" style="min-width:160px;">
      <small style="opacity:.85;">Play Mode</small>
      <select id="abgm_playMode" class="abgm-select abgm-select-slim" title="Works when Keyword Mode is OFF">
        <option value="manual">Manual</option>
        <option value="loop_one">Loop One</option>
        <option value="loop_list">Loop List</option>
        <option value="random">Random</option>
      </select>
    </div>
  </div>
  
   <!-- 2줄: Default 어쩌고 -->
<div class="abgm-top-row2">

  <!-- Use Default (좌측) -->
  <label class="checkbox_label abgm-top-item left" style="margin:0;">
    <input type="checkbox" id="abgm_useDefault">
    <small>Use Default when no keyword</small>
  </label>

  <!-- Default select (우측) -->
  <div class="abgm-top-item right" style="min-width:160px;">
    <small style="opacity:.85;">Default</small>
    <select id="abgm_default_select" class="abgm-select"></select>
  </div>
</div>

  <!-- 3줄: Global Volume -->
  <div class="abgm-top-row1">
    <div class="abgm-volume-block">
      <small style="opacity:.85;">Global Volume</small>
      <div style="display:flex; align-items:center; gap:10px;">
        <input id="abgm_globalVol" type="range" min="0" max="100" value="70" class="abgm-range">
        <small id="abgm_globalVolText" style="opacity:.85; width:38px; text-align:right;">70</small>
      </div>
    </div>
  </div>

</div>

    <div class="abgm-grid">
      <!-- LEFT: Presets -->
      <section class="abgm-card">
        <div class="abgm-card-h">
          <b>Presets</b>
          <div class="abgm-row">
            <div class="menu_button" id="abgm_preset_add" title="New Preset">
              <i class="fa-solid fa-plus"></i>
            </div>
            <div class="menu_button" id="abgm_preset_del" title="Delete Preset">
              <i class="fa-solid fa-trash"></i>
            </div>
          </div>
        </div>

        <div class="abgm-row" style="gap:8px;">
          <select id="abgm_preset_select" class="abgm-select"></select>
        </div>

        <div class="abgm-row" style="gap:8px; margin-top:8px;">
          <input id="abgm_preset_name" class="text_pole" placeholder="Preset name" style="flex:1;">
          <div class="menu_button" id="abgm_preset_rename" title="Rename">
            <i class="fa-solid fa-pen"></i>
          </div>
        </div>

<div class="abgm-row abgm-preset-actions" style="gap:10px; margin-top:10px; flex-wrap:wrap; align-items:center;">
  <div class="menu_button" id="abgm_bind_open" title="Bind this preset to character cards">
    <i class="fa-solid fa-link"></i> Bind
  </div>
<div class="menu_button" id="abgm_preset_help_toggle" title="Preset help">
  <i class="fa-solid fa-book"></i>
</div>

  <!-- 오른쪽으로 밀기 -->
  <div class="abgm-row" style="gap:10px; margin-left:auto; flex-wrap:wrap; align-items:center;">
    <div class="menu_button" id="abgm_import"><i class="fa-solid fa-file-import"></i> Import</div>
    <div class="menu_button" id="abgm_export"><i class="fa-solid fa-file-export"></i> Export</div>
  </div>

  <input id="abgm_import_file" type="file" accept="application/json" style="display:none;">
</div>

<hr class="abgm-hr"/>

        <div class="abgm-minihelp" id="abgm_preset_help" style="display:none;">
          프리셋은 설명<br/>
          어쩌고저쩌고
        </div>
      </section>

<!-- RIGHT: BGM List -->
<section class="abgm-card">
  <div class="abgm-card-h">
    <b>BGM List</b>
    <div class="abgm-row">
      <div class="menu_button" id="abgm_bgm_add" title="Add MP3">
        <i class="fa-solid fa-music"></i>
      </div>
      <div class="menu_button" id="abgm_zip_add" title="Add ZIP">
        <i class="fa-solid fa-file-zipper"></i>
      </div>
      <input id="abgm_zip_file" type="file" accept=".zip,application/zip" style="display:none;">
    </div>
  </div>

  <!-- ===== BGM List controls (2 rows + help) ===== -->

  <!-- Row 1: selected count (left) / sort (right) -->
  <div class="abgm-row abgm-bgmbar1" style="margin-top:8px;">
    <small id="abgm_selected_count" style="opacity:.75;">0 selected</small>

    <div class="abgm-inline" style="margin-left:auto; min-width:240px;">
      <small style="opacity:.85;">Sort</small>
      <select id="abgm_sort" class="abgm-select abgm-select-slim">
        <option value="added_asc">Added (old → new)</option>
        <option value="added_desc">Added (new → old)</option>
        <option value="name_asc">Name (A → Z)</option>
        <option value="name_desc">Name (Z → A)</option>
      </select>
    </div>
  </div>

  <!-- Row 2: delete+help (left) / add+expand+collapse+lock (right) -->
<div class="abgm-row abgm-bgmbar2" style="margin-top:8px; align-items:center; gap:10px;">
  <div class="menu_button" id="abgm_delete_selected" title="Delete selected rows">
    <i class="fa-solid fa-trash"></i> Delete Selected
  </div>

  <!-- help 버튼: Delete 옆으로 이동 -->
  <div class="menu_button" id="abgm_bgm_help_toggle" title="BGM List help">
    <i class="fa-solid fa-book"></i>
  </div>

  <!-- 우측 정렬 영역 -->
  <div class="abgm-row" style="margin-left:auto; gap:10px; align-items:center;">
    <!-- 엔트리 추가 버튼: 책 버튼 원래 자리로 -->
    <div class="menu_button" id="abgm_bgm_add_row" title="Add empty entry">
      <i class="fa-solid fa-plus"></i>
    </div>

    <div class="menu_button" id="abgm_expand_all" title="Expand all rows">
      <i class="fa-solid fa-angles-down"></i>
    </div>
    <div class="menu_button" id="abgm_collapse_all" title="Collapse all rows">
      <i class="fa-solid fa-angles-up"></i>
    </div>
    <div class="menu_button" id="abgm_lock_all_vol" title="Lock all volume sliders">
      <i class="fa-solid fa-lock"></i>
    </div>
  </div>

  <input id="abgm_bgm_file" type="file" accept="audio/mpeg,audio/mp3" style="display:none;">
</div>

  <!-- Row 3: help (collapsed by default) -->
  <div class="abgm-minihelp" id="abgm_bgm_help" style="display:none;">
    키워드는 쉼표로 구분 (예: rain, storm, thunder)<br/>
    웅앵 어쩌고저쩌고 BGM List 설명
  </div>

  <!-- 집 나갔던 파일들 -->
  <div class="abgm-tablewrap">
    <table class="abgm-table">
      <thead>
        <tr>
          <th class="abgm-col-check">
            <input type="checkbox" id="abgm_sel_all" title="Select all">
          </th>
          <th>File</th>
          <th style="width:92px;">Play</th>
          <th style="width:64px;">More</th>
        </tr>
      </thead>
      <tbody id="abgm_bgm_tbody"></tbody>
    </table>
  </div>
</section>
    </div>
  
  <!-- Bind Overlay (covers modal) -->
  <div id="abgm_bind_overlay" style="
  display:none;
  position:fixed;
  left:0; top:0;
  width:100vw;
  height:100vh;
  height:100dvh;
  z-index:9999999;
  align-items:center;
  justify-content:center;
  padding:12px;
  padding-top:calc(12px + env(safe-area-inset-top));
  padding-bottom:calc(12px + env(safe-area-inset-bottom));
  box-sizing:border-box;
  background:rgba(0,0,0,.55);
">

    <div style="width:min(560px, calc(100vw - 24px)); height:min(70dvh, 560px); background:rgba(20,20,20,.98); border:1px solid rgba(255,255,255,.14); border-radius:14px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.55);">
      <div style="display:flex; align-items:center; justify-content:space-between; padding:12px 12px 10px 12px; border-bottom:1px solid rgba(255,255,255,.10); gap:10px;">
        <b id="abgm_bind_title">Bind Preset</b>
        <div class="menu_button" id="abgm_bind_close" title="Close">
          <i class="fa-solid fa-xmark fa-lg"></i>
        </div>
      </div>

      <div style="padding:10px 12px; height:calc(100% - 52px); display:flex; flex-direction:column; gap:10px;">
        <small id="abgm_bind_sub" style="opacity:.75;">Select a character</small>
        <div id="abgm_bind_list" style="flex:1; overflow:auto; display:flex; flex-direction:column; gap:8px; padding:2px;"></div>
      </div>
    </div>
  </div>
</div>
</div>
